<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test KYC System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-6">ğŸ¦ Test Há»‡ Thá»‘ng KYC</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- KYC Form -->
            <div class="space-y-4">
                <h2 class="text-lg font-semibold text-gray-800">ğŸ“‹ ThÃ´ng tin KYC</h2>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ‘¤ Há» vÃ  tÃªn</label>
                    <input type="text" id="kycFullName" placeholder="Nguyá»…n VÄƒn A" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“… NgÃ y sinh</label>
                    <input type="date" id="kycBirthDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i</label>
                    <input type="tel" id="kycPhone" placeholder="0123456789" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“§ Email</label>
                    <input type="email" id="kycEmail" placeholder="user@example.com" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ  Äá»‹a chá»‰</label>
                    <textarea id="kycAddress" rows="2" placeholder="123 ÄÆ°á»ng ABC, Quáº­n XYZ, TP.HCM" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“„ Loáº¡i giáº¥y tá»</label>
                    <select id="kycIdType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                        <option value="">Chá»n loáº¡i giáº¥y tá»</option>
                        <option value="cccd">CÄƒn cÆ°á»›c cÃ´ng dÃ¢n</option>
                        <option value="cmnd">Chá»©ng minh nhÃ¢n dÃ¢n</option>
                        <option value="passport">Há»™ chiáº¿u</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ”¢ Sá»‘ giáº¥y tá»</label>
                    <input type="text" id="kycIdNumber" placeholder="123456789" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ¦ TÃªn ngÃ¢n hÃ ng</label>
                    <input type="text" id="kycBankName" placeholder="Vietcombank" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ¢ Chi nhÃ¡nh</label>
                    <input type="text" id="kycBankBranch" placeholder="Chi nhÃ¡nh HÃ  Ná»™i" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ’³ Sá»‘ tÃ i khoáº£n</label>
                    <input type="text" id="kycBankAccount" placeholder="1234567890" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ‘¤ TÃªn chá»§ tÃ i khoáº£n</label>
                    <input type="text" id="kycAccountHolderName" placeholder="Nguyá»…n VÄƒn A" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <button onclick="testKycSubmit()" class="w-full bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700">
                    ğŸš€ Test Gá»­i KYC
                </button>

                <button onclick="testKycStatus()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">
                    ğŸ“Š Test Kiá»ƒm tra KYC Status
                </button>
            </div>

            <!-- Test Withdrawal -->
            <div class="space-y-4">
                <h2 class="text-lg font-semibold text-gray-800">ğŸ’° Test RÃºt Tiá»n (Sau KYC)</h2>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ’° Sá»‘ tiá»n rÃºt (VNÄ)</label>
                    <input type="number" id="withdrawAmount" min="100000" step="10000" placeholder="500000" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ LÃ½ do rÃºt tiá»n</label>
                    <textarea id="withdrawReason" rows="2" placeholder="Cáº§n tiá»n chi tiÃªu..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"></textarea>
                </div>

                <button onclick="testWithdrawal()" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700">
                    ğŸ’° Test RÃºt Tiá»n
                </button>

                <button onclick="testWithdrawalHistory()" class="w-full bg-yellow-600 text-white py-2 px-4 rounded-lg hover:bg-yellow-700">
                    ğŸ“Š Test Lá»‹ch Sá»­ RÃºt Tiá»n
                </button>
            </div>
        </div>

        <div id="result" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
            <h3 class="font-semibold text-gray-800 mb-2">Káº¿t quáº£:</h3>
            <pre id="resultContent" class="text-sm text-gray-700 whitespace-pre-wrap"></pre>
        </div>
    </div>

    <script>
        async function testKycSubmit() {
            const fullName = document.getElementById('kycFullName').value;
            const birthDate = document.getElementById('kycBirthDate').value;
            const phone = document.getElementById('kycPhone').value;
            const email = document.getElementById('kycEmail').value;
            const address = document.getElementById('kycAddress').value;
            const idType = document.getElementById('kycIdType').value;
            const idNumber = document.getElementById('kycIdNumber').value;
            const bankName = document.getElementById('kycBankName').value;
            const bankBranch = document.getElementById('kycBankBranch').value;
            const bankAccount = document.getElementById('kycBankAccount').value;
            const accountHolderName = document.getElementById('kycAccountHolderName').value;

            if (!fullName || !birthDate || !phone || !email || !address || !idType || !idNumber || !bankName || !bankBranch || !bankAccount || !accountHolderName) {
                alert('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!');
                return;
            }

            try {
                const response = await fetch('/api/test-kyc-submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        fullName,
                        idNumber,
                        idType,
                        birthDate,
                        address,
                        phone,
                        email,
                        bankAccount,
                        bankName,
                        bankBranch,
                        accountHolderName
                    })
                });

                const result = await response.json();
                
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('resultContent').textContent = JSON.stringify(result, null, 2);

                if (result.success) {
                    alert(`âœ… Test KYC thÃ nh cÃ´ng!\n\nğŸ“‹ MÃ£ KYC: ${result.data.kycId}\nğŸ“‹ Tráº¡ng thÃ¡i: ${result.data.status}`);
                } else {
                    alert(`âŒ Test KYC tháº¥t báº¡i: ${result.message}`);
                }

            } catch (error) {
                console.error('KYC test error:', error);
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('resultContent').textContent = `Error: ${error.message}`;
                alert('âŒ CÃ³ lá»—i xáº£y ra khi test KYC. Vui lÃ²ng thá»­ láº¡i.');
            }
        }

        async function testKycStatus() {
            try {
                const response = await fetch('/api/test-kyc-status');
                const result = await response.json();
                
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('resultContent').textContent = JSON.stringify(result, null, 2);

                if (result.success) {
                    if (result.data) {
                        alert(`âœ… KYC Status: ${result.data.status}`);
                    } else {
                        alert('â„¹ï¸ ChÆ°a cÃ³ thÃ´ng tin KYC');
                    }
                } else {
                    alert(`âŒ Test KYC status tháº¥t báº¡i: ${result.message}`);
                }

            } catch (error) {
                console.error('KYC status test error:', error);
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('resultContent').textContent = `Error: ${error.message}`;
                alert('âŒ CÃ³ lá»—i xáº£y ra khi test KYC status. Vui lÃ²ng thá»­ láº¡i.');
            }
        }

        async function testWithdrawal() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const reason = document.getElementById('withdrawReason').value;

            if (!amount) {
                alert('Vui lÃ²ng nháº­p sá»‘ tiá»n!');
                return;
            }

            if (amount < 100000) {
                alert('Sá»‘ tiá»n rÃºt tá»‘i thiá»ƒu lÃ  100,000 VNÄ!');
                return;
            }

            try {
                const response = await fetch('/api/test-withdrawal-kyc', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: amount,
                        reason: reason || ''
                    })
                });

                const result = await response.json();
                
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('resultContent').textContent = JSON.stringify(result, null, 2);

                if (result.success) {
                    alert(`âœ… Test rÃºt tiá»n thÃ nh cÃ´ng!\n\nğŸ’° Sá»‘ tiá»n: ${amount.toLocaleString('vi-VN')} VNÄ\nğŸ“‹ MÃ£ yÃªu cáº§u: ${result.data.withdrawalId}`);
                } else {
                    alert(`âŒ Test rÃºt tiá»n tháº¥t báº¡i: ${result.message}`);
                }

            } catch (error) {
                console.error('Withdrawal test error:', error);
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('resultContent').textContent = `Error: ${error.message}`;
                alert('âŒ CÃ³ lá»—i xáº£y ra khi test rÃºt tiá»n. Vui lÃ²ng thá»­ láº¡i.');
            }
        }

        async function testWithdrawalHistory() {
            try {
                const response = await fetch('/api/test-withdrawal-history');
                const result = await response.json();
                
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('resultContent').textContent = JSON.stringify(result, null, 2);

                if (result.success) {
                    alert(`âœ… Test lá»‹ch sá»­ thÃ nh cÃ´ng!\n\nğŸ“Š Sá»‘ yÃªu cáº§u: ${result.data.length}`);
                } else {
                    alert(`âŒ Test lá»‹ch sá»­ tháº¥t báº¡i: ${result.message}`);
                }

            } catch (error) {
                console.error('Withdrawal history test error:', error);
                document.getElementById('result').classList.remove('hidden');
                document.getElementById('resultContent').textContent = `Error: ${error.message}`;
                alert('âŒ CÃ³ lá»—i xáº£y ra khi test lá»‹ch sá»­ rÃºt tiá»n. Vui lÃ²ng thá»­ láº¡i.');
            }
        }
    </script>
</body>
</html>
